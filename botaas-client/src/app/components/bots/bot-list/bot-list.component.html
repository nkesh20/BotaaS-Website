<div class="bot-list-container">
    <!-- Header -->
    <div class="header">
        <h1>My Telegram Bots</h1>
        <button mat-raised-button color="primary" (click)="addNewBot()">
            <mat-icon>add</mat-icon>
            Add New Bot
        </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
        <mat-spinner></mat-spinner>
        <p>Loading your bots...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-container">
        <mat-icon color="warn">error</mat-icon>
        <p>{{ error }}</p>
        <button mat-button color="primary" (click)="loadBots()">Try Again</button>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && bots.length === 0" class="empty-state">
        <mat-icon>smart_toy</mat-icon>
        <h2>No bots yet</h2>
        <p>Get started by adding your first Telegram bot</p>
        <button mat-raised-button color="primary" (click)="addNewBot()">
            <mat-icon>add</mat-icon>
            Add Your First Bot
        </button>
    </div>

    <!-- Bot Cards with Enhanced Layout -->
    <div *ngIf="!loading && !error && bots.length > 0" class="bots-grid">
        <div *ngFor="let bot of bots" class="bot-container">
            
            <!-- Main Bot Info Card -->
            <mat-card class="bot-card">
                <mat-card-header>
                    <div mat-card-avatar class="bot-avatar">
                        <img *ngIf="bot.bot_picture_url; else defaultIcon" [src]="bot.bot_picture_url" [alt]="bot.first_name" class="bot-image" (error)="onBotImageError($event)">
                        <ng-template #defaultIcon>
                            <mat-icon>smart_toy</mat-icon>
                        </ng-template>
                    </div>
                    <mat-card-title>{{ bot.first_name }}</mat-card-title>
                    <mat-card-subtitle>{{ bot.username }}</mat-card-subtitle>

                    <!-- Menu Button -->
                    <button mat-icon-button [matMenuTriggerFor]="botMenu" class="menu-button">
                        <mat-icon>more_vert</mat-icon>
                    </button>

                    <!-- Bot Menu -->
                    <mat-menu #botMenu="matMenu">
                        <button mat-menu-item (click)="editBot(bot)">
                            <mat-icon>edit</mat-icon>
                            <span>Edit Bot</span>
                        </button>
                        <button mat-menu-item (click)="manageFlows(bot)">
                            <mat-icon>account_tree</mat-icon>
                            <span>Manage Flows</span>
                        </button>
                        <button mat-menu-item (click)="toggleBotStatus(bot)">
                            <mat-icon>{{ bot.is_active ? 'pause' : 'play_arrow' }}</mat-icon>
                            <span>{{ bot.is_active ? 'Deactivate' : 'Activate' }}</span>
                        </button>
                        <button mat-menu-item (click)="deleteBot(bot)" class="delete-item">
                            <mat-icon>delete</mat-icon>
                            <span>Delete</span>
                        </button>
                    </mat-menu>
                </mat-card-header>

                <mat-card-content>
                    <!-- Description section -->
                    <div *ngIf="bot.short_description" class="bot-description">
                        <p>{{ bot.short_description }}</p>
                    </div>

                    <!-- Status Chips -->
                    <div class="status-chips">
                        <mat-chip-listbox>
                            <mat-chip [color]="bot.is_active ? 'primary' : 'warn'" selected>
                                {{ bot.is_active ? 'Active' : 'Inactive' }}
                            </mat-chip>
                            <mat-chip *ngIf="bot.can_join_groups" color="accent" selected>
                                Groups
                            </mat-chip>
                            <mat-chip *ngIf="bot.supports_inline_queries" color="accent" selected>
                                Inline
                            </mat-chip>
                        </mat-chip-listbox>
                    </div>
                </mat-card-content>

                <mat-card-actions>
                    <button mat-button (click)="manageFlows(bot)" color="primary">
                        <mat-icon>account_tree</mat-icon>
                        Flows
                    </button>
                    <button mat-button (click)="toggleBotStatus(bot)" [color]="bot.is_active ? 'warn' : 'primary'">
                        <mat-icon>{{ bot.is_active ? 'pause' : 'play_arrow' }}</mat-icon>
                        {{ bot.is_active ? 'Deactivate' : 'Activate' }}
                    </button>
                    <button mat-button (click)="editBot(bot)">
                        <mat-icon>settings</mat-icon>
                        Settings
                    </button>
                </mat-card-actions>
            </mat-card>

            <!-- Bot Status Component - This is where your status component goes -->
            <app-bot-status [bot]="bot"></app-bot-status>

        </div>
    </div>
</div>