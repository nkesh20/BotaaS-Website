<form [formGroup]="broadcastForm" (ngSubmit)="submit()" class="broadcast-form mat-elevation-z2">
  <mat-card>
    <mat-card-title>{{ 'broadcast.title' | translate }}</mat-card-title>
    <mat-card-content>
      <div class="form-group">
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>{{ 'broadcast.selectBot' | translate }}</mat-label>
          <mat-select formControlName="bot_id" required>
            <mat-option *ngFor="let bot of bots" [value]="bot.id">{{ bot.first_name }} ({{ bot.username }})</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      
      <div class="variables-section">
        <h3>{{ 'broadcast.availableVariables' | translate }}</h3>
        <p class="variables-description">{{ 'broadcast.variablesDescription' | translate }}</p>
        <div class="variables-grid">
          <button 
            *ngFor="let variable of availableVariables" 
            mat-stroked-button 
            type="button" 
            (click)="insertVariable(variable.key)"
            class="variable-button">
            <span class="variable-label">{{ variable.label | translate }}</span>
          </button>
        </div>
      </div>

      <div class="form-group">
        <mat-form-field appearance="fill" class="full-width">
          <mat-label>{{ 'broadcast.message' | translate }}</mat-label>
          <textarea 
            matInput 
            formControlName="text" 
            rows="5" 
            required 
            maxlength="4096" 
            [placeholder]="'broadcast.messagePlaceholder' | translate">
          </textarea>
          <mat-hint align="end">{{ broadcastForm.get('text')?.value?.length || 0 }}/4096</mat-hint>
        </mat-form-field>
      </div>

      <div class="form-row">
        <mat-form-field appearance="fill">
          <mat-label>{{ 'broadcast.scheduleDate' | translate }}</mat-label>
          <input 
            matInput 
            [matDatepicker]="datePicker" 
            formControlName="scheduled_date" 
            [placeholder]="'broadcast.scheduleDatePlaceholder' | translate">
          <mat-datepicker-toggle matSuffix [for]="datePicker"></mat-datepicker-toggle>
          <mat-datepicker #datePicker></mat-datepicker>
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>{{ 'broadcast.scheduleTime' | translate }}</mat-label>
          <input 
            matInput 
            type="time" 
            formControlName="scheduled_time" 
            [placeholder]="'broadcast.scheduleTimePlaceholder' | translate">
        </mat-form-field>
        <mat-form-field appearance="fill">
          <mat-label>{{ 'broadcast.parseMode' | translate }}</mat-label>
          <mat-select formControlName="parse_mode">
            <mat-option value="Markdown">{{ 'broadcast.parseModeMarkdown' | translate }}</mat-option>
            <mat-option value="HTML">{{ 'broadcast.parseModeHtml' | translate }}</mat-option>
            <mat-option value="Plain">{{ 'broadcast.parseModePlain' | translate }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </mat-card-content>
    <mat-card-actions align="end">
      <button mat-raised-button color="primary" type="submit" [disabled]="broadcastForm.invalid || loading">
        <mat-progress-spinner *ngIf="loading" diameter="20" mode="indeterminate"></mat-progress-spinner>
        <span *ngIf="!loading">{{ 'broadcast.sendBroadcast' | translate }}</span>
      </button>
    </mat-card-actions>
  </mat-card>
</form> 